# 操作系统——学霸养成记

## 第一章 计算机系统概述

### 1.1 操作系统的基本概念

【知识框架导图】

![image-20201030110724877](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20201030110724877.png)

#### 1.11 操作系统的概念

​		计算机系统自下而上可大致分为4部分∶硬件、操作系统、应用程序和用户（这里的划分与计算机组成原理中的分层不同）。操作系统管理各种计算机硬件，为应用程序提供基础，并充当计算机硬件与用户之间的中介。
硬件如中央处理器、内存、输入/输出设备等，提供基本的计算资源。应用程序如字处理程序、电子制表软件、编译器、网络浏览器等，规定按何种方式使用这些资源来解决用户的计算问题。操作系统控制和协调各用户的应用程序对硬件的分配与使用。

综上所述：操作系统（Operating System，OS）是指控制和管理整个计算机系统的硬件与软件资源，合理地组织、调度计算机的工作与资源的分配，进而为用户和其他软件提供方便接口与环境的程序集合。操作系统是计算机系统中最基本的系统软件。

#### 1.12 操作系统的特征

操作系统的基本特征包括并发、共享、虚拟和异步。

##### 1、并发（Concurrence）

并发是指两个或多个事件在同一时间间隔内发生。操作系统的并发性是指计算机系统中同时存在多个运行的程序，因此它具有处理和调度多个程序同时执行的能力。在操作系统中，引入进
程的目的是使程序能并发执行。

并发和并行：注意同一时间间隔（并发）和同一时刻（并行）的区别。

举例：

一会写字，一会吃面包----并发

边吃面包变写字-------------并行

##### 2、共享（Sharing）

资源共享即共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。共享可分为以下两种资源共享方式。
（1）互斥共享方式
系统中的某些资源，如打印机、磁带机，虽然可供多个进程使用，但为使得所打印或记录的结果不致造成混淆，应规定在一段时间内只允许一个进程访问该资源。
为此，当进程 A 访问某个资源时，必须先提出请求，若此时该资源空闲，则系统便将之分配给进程A使用，此后有其他进程也要访问该资源时（只要A未用完）就必须等待。仅当进程A访问完并释放该资源后，才允许另一个进程对该资源进行访问。我们把这种资源共享方式称为互斥式共享，而把在一段时间内只允许一个进程访问的资源称为临界资源或独占资源。计算机系统中的大多数物理设备及某些软件中所用的栈、变量和表格，都属于临界资源，它们都要求被互斥地共享。
（2）同时访问方式

系统中还有另一类资源，这类资源允许在一段时间内由多个进程"同时"访问。这里所说的"同时"通常是宏观上的，而在微观上，这些进程可能是交替地对该资源进行访问即"分时共享"的。可供多个进程"同时"访问的典型资源是磁盘设备，一些用重入码编写的文件也可被"同时"共享，即允许若干个用户同时访问该文件。
注意，互斥共享要求一种资源在一段时间内（哪怕是一段很小的时间）只能满足一个请求，否则就会出现严重的问题，（你能想象打印机第一行打印A文档的内容、第二行打印B文档的内容的效果吗?）而同时访问共享通常要求一个请求分几个时间片段间隔地完成，其效果与连续完成的效果相同。

并发和共享是操作系统两个最基本的特征，两者之间互为存在的条件∶①资源共享是以程序的并发为条件的，若系统不允许程序并发执行，则自然不存在资源共享问题;②若系统不能对资源共享实施有效的管理，则必将影响到程序的并发执行，甚至根本无法并发执行。

##### 3、虚拟（Virtual）

​		虚拟是指把一个物理上的实体变为若干逻辑上的对应物。物理实体（前者）是实的，即实际存在的;而后者是虚的，是用户感觉上的事物。用于实现虚拟的技术，称为虚拟技术。操作系统中利用了多种虚拟技术来实现虚拟处理器、虚拟内存和虚拟外部设备等。
​		虚拟处理器技术是通过多道程序设计技术，采用让多道程序并发执行的方法，来分时使用一个处理器的。此时，虽然只有一个处理器，但它能同时为多个用户服务，使每个终端用户都感觉有一个中央处理器（CPU）在专门为它服务。利用多道程序设计技术把一个物理上的CPU虚拟为多个逻辑上的CPU，称为虚拟处理器。
类似地，可以采用虚拟存储器技术将一台机器的物理存储器变为虚拟存储器，以便从逻辑上扩充存储器的容量。当然，这时用户所感觉到的内存容量是虚的。我们把用户感觉到（但实际不存在）的存储器称为虚拟存储器。
还可采用虚拟设备技术将一台物理IO设备虚拟为多台逻辑上的IO设备，并允许每个用户占用一台逻辑上的IO设备，使原来仅允许在一段时间内由一个用户访问的设备（即临界资源）变为在一段时间内允许多个用户同时访问的共享设备。
因此，操作系统的虚拟技术可归纳为∶时分复用技术，如处理器的分时共享;空分复用技术，如虚拟存储器。

##### 4、异步（Asynchronism）

​		多道程序环境允许多个程序并发执行，但由于资源有限，进程的执行并不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进，这就是进程的异步性。
异步性使得操作系统运行在一种随机的环境下，可能导致进程产生与时间有关的错误（就像对全局变量的访问顺序不当会导致程序出错一样）。然而，只要运行环境相同，操作系统就须保证多次运行进程后都能获得相同的结果。

#### 1.13 操作系统的目标和功能

​		为了给多道程序提供良好的运行环境，操作系统应具有以下几方面的功能∶处理机管理、存储器管理、设备管理和文件管理。为了方便用户使用操作系统，还必须向用户提供接口。同时，操作系统可用来扩充机器，以提供更方便的服务、更高的资源利用率。

##### 1、操作系统作为计算机系统资源的管理者

（1）处理机管理

（2）存储器管理

（3）文件管理

（4）设备管理

##### 2、操作系统作为用户与计算机硬件系统之间的接口

（1）命令接口

​		使用命令接口进行作业控制的主要方式有两种，即联机控制方式和脱机控制方式。按作业控制方式的不同，可将命令接口分为联机命令接口和脱机命令接口。

（2）程序接口

（3）GUI

​		当前最为流行的是图形用户界面（GUI），即图形接口。GUI最终是通过调用程序接口实现的，用户通过鼠标和键盘在图形界面上单击或使用快捷键，就能很方便地使用操作系统。严格来说，图形接口不是操作系统的一部分，但图形接口所调用的系统调用命令是操作系统的一部分。









### 1.2 操作系统的发展与分类

#### 1.2.1 手工操作阶段（无操作系统）

#### 1.2.2 批处理阶段（操作系统开始出现）

​		为了解决CPU与I/0 设备速度不匹配的矛盾，出现了批处理系统。分为：单道批处理系统、多道批处理系统（多道程序设计技术出现以后）。

##### 1、单道批处理系统。

特征： 自动性，顺序性，单道性

##### 2、多道批处理系统

​		多道程序设计技术允许多个程序同时进入内存并允许它们在 CPU中交替地运行，这些程序共享系统中的各种硬/软件资源。当一道程序因I/O请求而暂停运行时，CPU便立即转去运行另一道程序。它不采用某些机制来提高某一技术方面的瓶颈问题，而让系统的各个组成部分都尽量去"忙"，因此切换任务所花费的时间很少，可实现系统各部件之间的并行工作，使其整体在单位时
间内的效率翻倍。

多道程序设计的特点是多道、宏观上并行、微观上串行。

1）多道。计算机内存中同时存放多道相互独立的程序。
2）宏观上并行。同时进入系统的多道程序都处于运行过程中，即它们先后开始各自的运行，但都未运行完毕。
3）微观上串行。内存中的多道程序轮流占有CPU，交替执行。

多道程序设计技术的实现需要解决下列问题∶

1）如何分配处理器。

2）多道程序的内存分配问题。

3）I/O设备如何分配。

4）如何组织和存放大量的程序和数据，以方便用户使用并保证其安全性与一致性。在批处理系统中采用多道程序设计技术就形成了多道批处理操作系统。该系统把用户提交的作业成批地送入计算机内存，然后由作业调度程序自动地选择作业运行。
优点∶资源利用率高，多道程序共享计算机资源，从而使各种资源得到充分利用;系统吞吐量大，CPU和其他资源保持"忙碌"状态。缺点∶用户响应的时间较长;不提供人机交互能力，

#### 1.2.3 分时操作系统

​		所谓分时技术，是指把处理器的运行时间分成很短的时间片，按时间片轮流把处理器分配给各联机作业使用。若某个作业在分配给它的时间片内不能完成其计算，则该作业暂时停止运行，把处理器让给其他作业使用，等待下一轮再继续运行。由于计算机速度很快，作业运行轮转得也很快，因此给每个用户的感觉就像是自己独占一台计算机。

#### 1.2.4 实时操作系统

​		飞机订票系统，银行管理系统   

特点：及时性，可靠性

#### 1.2.5 网络操作系统和分布式计算机系统

特点：网络中各种资源的共享及计算机之间的通信

分布式计算机系统：多台计算机组成，任意两台计算机通过通信方式交换信息，每台机地位相同，资源共享，任意台计算机都可以组成一个子系统

管理分布式计算机系统的操作系统成为   分布式计算机系统

特点：分不行和并行性  

分布式操作系统中的若干计算机相互协同完成同一任务

#### 1.2.6 个人计算机操作系统

个人计算机操作系统是目前使用最广泛的操作系统，它广泛应用于文字处理、电子表格、游戏中，常见的有Windows、Linux和Macintosh等。操作系统的发展历程如图11所示。

![image-20201031165633088](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20201031165633088.png)

此外，还有嵌入式操作系统、服务器操作系统、智能手机操作系统等。

1-5 D D A B A，6-10 D D C B D 11-15 A 

### 1.3 操作系统的运行环境

#### 1.3.1 操作系统的运行机制

​		计算机系统中，通常 CPU执行两种不同性质的程序∶一种是操作系统内核程序;另一种是用户自编程序（即系统外层的应用程序，或简称"应用程序"）。对操作系统而言，这两种程序的作用不同，前者管理后者。用户自编程序运行在用户态，操作系统内核程序运行在核心态。

##### 内核是计算机配置的底层软件，一般包括四方面：

##### 1、时钟管理

​		在计算机的各种部件中，时钟是最关键的设备。时钟的第一功能是计时，操作系统需要通过时钟管理，向用户提供标准的系统时间。另外，通过时钟中断的管理，可以实现进程的切换。例如，在分时操作系统中采用时间片轮转调度，在实时系统中按截止时间控制运行，在批处理系统中通过时钟管理来衡量一个作业的运行程度等。因此，系统管理的方方面面无不依赖于时钟。

##### 2.中断机制

​		引入中断技术的初衷是提高多道程序运行环境中 CPU的利用率，而且主要是针对外部设备的。后来逐步得到发展，形成了多种类型，成为操作系统各项操作的基础。例如，键盘或鼠标信息的输入、进程的管理和调度、系统功能的调用、设备驱动、文件访问等，无不依赖于中断机制。可以说，现代操作系统是靠中断驱动的软件。
中断机制中，只有一小部分功能属于内核，它们负责保护和恢复中断现场的信息，转移控制权到相关的处理程序。这样可以减少中断的处理时间，提高系统的并行处理能力。

##### 3.原语

​		按层次结构设计的操作系统，底层必然是一些可被调用的公用小程序，它们各自完成一个规定的操作。它们的特点如下∶
1）处于操作系统的最低层，是最接近硬件的部分。
2）这些程序的运行具有原子性，其操作只能一气呵成（主要从系统安全性和便于管理考虑）。

3）这些程序的运行时间都较短，而且调用频繁
通常把具有这些特点的程序称为原语（Atomic Operation）。定义原语的直接方法是关闭中断，让其所有动作不可分割地完成后再打开中断。
系统中的设备驱动、CPU切换、进程通信等功能中的部分操作都可定义为原语，使它们成为内核的组成部分。

##### 4.系统拉制的数据结构及处理

​		系统中用来登记状态信息的数据结构很多，如作业控制块、进程控制块（PCB）、设备控制块、各类链表、消息队列、缓冲区、空闲区登记表、内存分配表等。为了实现有效的管理，系统需要一些基本的操作，常见的操作有以下3种∶
1）进程管理。进程状态管理、进程调度和分派、创建与撤销进程控制块等。

2）存储器管理。存储器的空间分配和回收、内存信息保护程序、代码对换程序等。

3）设备管理。缓冲区管理、设备分配和回收等。
从上述内容可以了解，核心态指令实际上包括系统调用类指令和一些针对时钟、中断和原语的操作指令。

#### 1.3.2 中断和异常

![image-20201105153909384](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20201105153909384.png)





#### 1.3.3 系统调用

● 设备管理。完成设备的请求或释放，以及设备启动等功能。

● 文件管理。完成文件的读、写、创建及删除等功能。

● 进程控制。完成进程的创建、撤销、阻塞及唤醒等功能。

● 进程通信。完成进程之间的消息传递或信号传递等功能。

●内存管理。完成内存的分配、回收以及获取作业占用内存区大小及始址等功能。

### 1.4  操作系统的体系结构

#### 大内核和微内核

### 1.5 第一章总结

#### 1。并行性与并发性的区别和联系

并行性和并发性是既相似又有区别的两个概念。并行性是指两个或多个事件在同一时刻发生，并发性是指两个或多个事件在同一时间间隔内发生。
在多道程序环境下，并发性是指在一段时间内，宏观上有多个程序同时运行，但在单处理器系统中每个时刻却仅能有一道程序执行，因此微观上这些程序只能分时地交替执行。若在计算机系统中有多个处理器，则这些可以并发执行的程序便被分配到多个处理器上，实现并行执行，即利用每个处理器来处理一个可并发执行的程序。

#### 2。特权指令与非特权指令

谓特权指令，是指有特殊权限的指令，由于这类指令的权限最大，使用不当将导致整个系统崩溃，如清内存、置时钟、分配系统资源、修改虚存的段表或页表、修改用户的访问权限等。若所有程序都能使用这些指令，则系统一天死机n次就不足为奇。为保证系统安全，这类指令只能用于操作系统或其他系统软件，不直接提供给用户使用。因此，特权指令必须在核心态执行。实际上，CPU在核心态下可以执行指令系统的全集。形象地说，特权指令是那些儿童不宜的东西，而非特权指令是老少皆宜的东西。
为了防止用户程序中使用特权指令，用户态下只能使用非特权指令，核心态下可以使用全部指令。在用户态下使用特权指令时，将产生中断以阻止用户使用特权指令。所以把用户程序放在用户态下运行，而操作系统中必须使用特权指令的那部分程序在核心态下运行，保证了计算机系统的安全可靠。从用户态转换为核心态的唯一途径是中断或异常。

#### 3。访管指令与访管中断

访管指令是一条可以在用户态下执行的指令。在用户程序中，因要求操作系统提供服务而有意识地使用访管指令，从而产生一个中断事件（自愿中断），将操作系统转换为核心态，称为访管中断。访管中断由访管指令产生，程序员使用访管指令向操作系统请求服务。
为什么要在程序中引入访管指令呢?这是因为用户程序只能在用户态下运行。若用户程序想要完成在用户态下无法完成的工作，该怎么办?解决这个问题要靠访管指令。访管指令本身不是特权指令，其基本功能是让程序拥有"自愿进管"的手段，从而引起访管中断。
处于用户态的用户程序使用访管指令时，系统根据访管指令的操作数执行访管中断处理程序，访管中断处理程序将按系统调用的操作数和参数转到相应的例行子程序。完成服务功能后，退出中断，返回到用户程序断点继续执行。

## 第二章 进程管理

【内容】

（一）进程和线程

（二）处理机调度

（三）进程同步

（四）死锁

### 2.1 进程与线程

### 2.2 处理机调度

### 2.3 进程同步

### 2.4 死锁

（1）为什么产生死锁？产生死锁有什么条件

原因：

1、通常系统中拥有的不可剥夺资源，其数量不足以满足多个进程运行的需要，使得进程在运行过程中，会因争夺资源而陷入僵局，如磁带机、打印机等。只有对不可剥夺资源的竞争才可能产生死锁，对可剥夺资源的竞争是不会引起死锁的。

2、进程推进顺序非法

条件：只要满足任意一个条件不成立，死锁就不会发生

互斥条件，不剥夺条件，请求并保持条件，循环等待条件



由于系统中存在一些不可剥夺资源，当两个或两个以上的进程占有自身的资源并请求对方的资源时，会导致每个进程都无法向前推进，这就是死锁。死锁产生的必要条件有4个，分别是互斥条件、不剥夺条件、请求并保持条件和循环等待条件。
互斥条件是指进程要求分配的资源是排他性的，即最多只能同时供一个进程使用。不剥夺条件是指进程在使用完资源之前，资源不能被强制夺走。请求并保持条件是指进程占有自身本来拥有的资源并要求其他资源。循环等待条件是指存在一种进程资源的循环等待链。

（2）有什么办法解决死锁问题？

必须破坏产生死锁的四个必要条件之一；

1、死锁预防：设置某些限制条件，破坏产生死锁的四个必要条件

2、避免死锁，资源的动态分配过程中，用某些方法防治系统进入不安全状态

3、死锁的检测及解除：

### 2.5 第二章总结

![image-20210216172502997](C:\Users\CS_Chan\AppData\Roaming\Typora\typora-user-images\image-20210216172502997.png)

## 第三章 内存管理

### 3.1 内存管理概念



### 3.2 虚拟内存管理

### 3.3 第三章总结



## 第四章 文件管理

文件系统基础，文件的逻辑结构，顺序文件，索引文件，索引顺序文件

目录结构：文件控制块和索引节点，单级目录结构和两级目录结构，属性目录结构，图形目录结构

文件共享：文件保护，访问类型，访问控制

文件系统实现：文件系统层次结构，目录实现，文件实现

磁盘组织与管理：磁盘的结构，磁盘调度算法，磁盘的管理

### 4.1 文件管理基础



### 4.2 文件系统实现



### 4.3 磁盘组织与管理

### 4.4 第四章总结



## 第五章 输入输出（I/O管理）

### 5.1 I/O管理概述

### 5.2 I/0核心子系统

### 5.3 本章总结