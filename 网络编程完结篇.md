### 网络编程完结篇

1、什么是网络编程

本质是多态计算机之间的数据交互。基于请求和相应

2、网络编程的主要问题

1)一台是如何准确的定位网络上一台或多台主机

2）找到主机后如何可靠高效的进行数据传输

回答：

- 在TCP/IP协议中IP层主要复制网络主机的定位，数据传输的路由，有IP地址可以唯一的确定Internet上的一台主机。
- 而TCP层则提供面向应用的可靠（TCP）或者非可靠（UDP）的数据传输机制，这是网络编程的主要对象，一般不需要关心IP层如何处理数据。
- 目前流行的网络编程模型是cs结构，即使通信双方一方作为服务器等待客户端提出请求并给予相应。客户端则在需要服务时向服务器提出申请，服务器一般作为守护进程始终运行，监听网络端口，一旦有客户端请求，就会启动一个网络进程响应客户端，使用自己继续监听服务端口，使后来的客户端也能即使得到服务。

3、网络协议是什么？

在计算机网络要做到井井有条的交换数据，就必须遵守一些事先约定的规则。比如交换格式，是否需要发送一个应答信息等。

4、为什么要对网络协议分层？

- 简化问题难度和复杂度，由于各层网络之间独立，我们可以分割大问题为小问题。
- 灵活性好。当其中一层的技术变化时，只要层间接口关系保持不变，其他层不受影响。
- 易于实现和维护
- 初始标准化分工，分开后，每层功能可以相对简单得被描述。

OSA：应用层——表示层——会话层——传输层——网络层——数据链路层——物理层

TCP/IP：应用层——传输层——网络层——数据链路层

高级层（TCP：HTTP，Telnet，FTP，SMTP，UDP，DNS，RIP，SNMP）

传输层：TCP；UDP

基础层：IP，Ethernet

![image-20210816182813423](C:\Users\CS_Chan\AppData\Roaming\Typora\typora-user-images\image-20210816182813423.png)

5、TCP/IP模型

- TCP/IP四层协议（数据链路层，网络层，传输层，应用层）

  1）应用层

  应用层最靠近用户的一层，是为计算机用户提供应用接口，也为用户直接提供各种网络服务，我们常见应用层的网络服务协议有HTTP，HTTPS，FTP，TELNET等

  2）传输层

  建立在主机端到端的链接，传输层的作用是为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信的细节，是高层用户看到的是只是两个传输实体间的一条主机到主机的，可由用户控制和设定的、可靠的数据通路，我们通常说TCP、UDP都在这一层，端口号就是这里的“端”

  3）网络层

  本层通过IP寻址来建立两个节点之间的连接，为源端的运输层送来的分组，选择合适路由和交换节点，正确无误地按照地址传输目的端的运输层，一般说的是IP层，这一层就是IP协议层，IP协议层是Internet的基础。

  4）数据链路层

  通过一些规程或者协议来控制这些数据的传输，以保证被传输数据的正确性，实现这些规程或协议的硬件和软件加到物理线路，这样就构成了数据链路层。

6、什么是TCP/IP 和UDP？

- TCP/IP 即传输控制/网络协议，就是面向连接的协议，发送数据前要建立连接（发送方和接收方的两个之间必须建立连接），TCP提供可靠的服务，也就是通过TCP连接传输的数据不会丢失，没有重复，并且按顺序到达。
- UDP它属于TCP/IP协议族中的一种，是无连接的协议，发送数据前不需要建立连接，是没有可靠性的协议，因为不需要建立连接所以可以在网络上任何可能的路径传输，因此能否到达目的地，到达目的地的时间以及内容的正确性不能被保证。

7、TCP与UDP的区别

- TCP是面向连接的协议，发送数据要建立连接，TCP提供可靠的服务，也就是通过TCP连接传输的数据不会丢失，没有重复，并且按顺序到达。
- UDP是无连接的协议，发送数据不需要建立连接，没有可靠性
- TCP类似打电话，需要确认身份后进行通信，通信三次握手
- UDP类似学校广播，UDP支持一对一，一对多，多对一，多对多
- TCP是面向字节流，UDP是面向报文。面向字节流是指发送数据时以字节为单位，一个数据包可以拆分成若干组进行发送，而UDP一个报文只能一次发完。
- TCP首部开销（20字节）比UDP首部开销（8字节）要大
- UDP的主机不需要维持复杂的连接状态表。

8、TCP和UDP的应用场景

对于某些实时性要求比较高的情况使用UDP：比如游戏，媒体通信，实时直播，即使出现传输错误可以容忍；其他大部分情况HTTP都是用TCP，因为要求传输的内容可靠，不出现丢失情况。

9、运行在TCP或UDP的应用层协议分析

- 运行在TCP协议上的协议：
  - HTTP：超文本传输协议，用于网上冲浪
  - HTTPS：安全超文本传输协议，HTTP协议的安全版本
  - FTP：文件传输协议，用于文件传输
  - POP3：邮局协议，收邮件用
  - SMTP：简单邮件传输协议，用来发送电子邮件
  - TELNET：网络电传，通过一个终端登录到网络
  - SSH：用于替代安全性插的TELNET，用于加密安全登录用
- 运行在UDP协议上的协议：
  - BOOTP：启动协议，应用于无盘设备
  - NTP：网络时间协议，用于网络同步
  - DHCP：动态主机配置协议，动态配置IP地址
- 运行在TCP和UDP协议上：
  - DNS：域名服务，用于完成地址查找，邮件转发等工作；
  - ECHO：回绕协议，用于查错及测量应答时间（运行在TCP和UDP协议上）
  - SNMP：简单网络管理协议，用于网络信息的收集和网络管理。
  - DHCP：动态主机配置协议，动态配置IP地址
  - ARP：地址解析协议，用于解析以太网硬件的地址

10、什么是ARP协议？

- **ARP协议完成了IP地址与物理地址的映射**。每个主机设有一个ARP高速缓存，里面有所在的局域网的各主机和路由器的IP地址到硬件地址的映射表，当源主机要发送数据包到目的主机时，会检查自己的ARP高速缓存中的有没有目的主机的MAC地址，如果有就直接将数据包发送到这个MAC地址，如果没有，就向所在的局域网发起一个ARP请求的的广播包（在发送自己的ARP请求时，同时会带上自己IDEIP地址到硬件地址的映射），收到请求的主机检查自己的IP地址和目的的主机IP地址是否一致，如果一致，则先保存源主机的映射到自己的ARP缓存，然后给源主机发送一个ARP响应数据包。源主机收到响应数据包之后，先添加目的主机的IP地址与MAC地址的映射，再进行数据传送，如果源主机一直没有收到响应，表示ARP查询失败、
- 如果所要找的主机和源主机不在同一个局域网上，那么就要通过ARP找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器吧分组转发给下一个网络，剩下的工作就是由下一个网络来做。

11、什么是NAT Network Address Translation，网络地址转换？

- 用于解决内网中的主机要和Internet上的主机通信，由NAT路由器将主机的本地IP地址转换为全球IP地址，分静态转换（转换得到的全球IP地址固定不变）和动态NAT转换

12、从输入地址获得页面的过程？

- 浏览器查询DNS，获取域名对应的IP地址：具体过程包括浏览器搜索自身的DNS缓存，搜索操作系统的DNS缓存，读取本地的host文件向本地DNS服务器进行查询。对于向本地DNS服务器进行查询，如果查询的域名包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析（此解析具有权威性）；如果查询的域名不由本地DNS服务器区域解析，但该服务器已缓存了此网络映射关系，则调用这个IP地址映射，完成域名解析（此解析不具有权威性）如果本地域名服务器并未缓存该网址映射关系，那么将根据设置发起递归查询或者迭代插查询。
- 浏览器获得域名对应的IP地址以后，浏览器向服务器请求连接，发起三次握手；
- TCP/IP连接建立起来后，浏览器向服务器请求HTTP请求；
- 服务器接受这个请求，并根据路径参数映射到特定的请求处理器进行处理，并将处理结果及相应的视图返回给浏览器。
- 浏览器解析并渲染视图，如果遇到JS、CSS文件以及图片等静态资源的引用，则重复上述步骤并向服务器请求这些资源。
- 浏览器根据请求到的资源，数据渲染页面，最终向用户呈现一个完整的页面。

13、TCP的三次握手

![image-20210816192125374](C:\Users\CS_Chan\AppData\Roaming\Typora\typora-user-images\image-20210816192125374.png)

- 第一次握手：客户端将syn = 1，和初始序列号seq发送给 服务端，进入syn_sent状态
- 第二次握手：服务端收到客户端syn= 1后，知道客户端请求建立连接，将自己的syn设置为1，ack 设置为1，产生一个acknowledge number = seq +1;并随机产生一个序列号，发送给客户端 ，并进入syn_rcvd状态
- 第三次握手：客户端检查acknowledge number是否为序列号+1，ack 是否为1，检查正确后将自己ack设置为1，产生一个acknowledge number = 服务器的序列号+1，发送给服务器，进入establish 状态，服务器检查ack 为1 和acknowledge number 为序列号+1之后也进入establish状态，完成三次握手，进行连接、、

简单的说就是：

​	1）客户端向服务端发送syn；2）服务端返回syn，ack；3）客户端发送ack；

为什么不可以两次？

- 因为可能会出现已失效的连接请求报文段又传到了服务器端。 > client 发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达 server。本来这是一个早已失效的报文段。但 server 收到此失效的连接请求报文段后，就误认为是 client 再次发出的一个新的连接请求。于是就向 client 发出确认报文段，同意建立连接。假设不采用 “三次握手”，那么只要 server 发出确认，新的连接就建立了。由于现在 client 并没有发出建立连接的请求，因此不会理睬 server 的确认，也不会向 server 发送数据。但 server 却以为新的运输连接已经建立，并一直等待 client 发来数据。这样，server 的很多资源就白白浪费掉了。采用 “三次握手” 的办法可以防止上述现象发生。例如刚才那种情况，client 不会向 server 的确认发出确认。server 由于收不到确认，就知道 client 并没有要求建立连接。
- 而且，两次握手无法保证Client正确接收第二次握手的报文（Server无法确认Client是否收到），也无法保证Client和Server之间成功互换初始序列号。

四次**握手**的话就是降低传输效率了



14、TCP四次挥手（传输层协议断开连接的过程）

- 第一次挥手：客户端将FIN设置为1，发送一个序列号seq 给服务端，进入FIN_WAIT状态；
- 第二次挥手：服务端收到FIN之后，发送一个ACK = 1，acknowledge number收到的序列号+1;进入close_wait状态。此时客户端已经没有要发送的数据了，但仍可以接受服务端发来的数据。
- 第三次挥手：服务端将FIN设置为1，发送一个序列号给客户端，进入Last_ACk状态；
- 第四次挥手：客户端收到服务端的FIN后，进入time_wait状态，接着将ACK设置为1，发送一个acknowledge number = 序列号+1给服务器，服务器收到后，确认acknowledge number后，变为closed状态，不再向客户端发送数据。客户端等待一段时间后（报文段最长寿命），也进入closed状态，完成四次挥手。

SOCKET

15、什么是socket

- 网络上的两个程序通过一个双向的通讯连接实现数据的交换，这个双向链路的一端称为一个Socket。Socket通常用来实现客户方和服务方的连接。Socket是TCP/IP协议的一个十分流行的编程界面，一个Socket由一个IP地址和一个端口号唯一确定。

- 但是，Socket所支持的协议种类也不光TCP/IP、UDP，因此两者之间是没有必然联系的。在Java环境下，Socket编程主要是指基于TCP/IP协议的网络编程。

- socket连接就是所谓的长连接，客户端和服务器需要互相连接，理论上客户端和服务器端一旦建立起连接将不会主动断掉的，但是有时候网络波动还是有可能的
- Socket偏向于底层。一般很少直接使用Socket来编程，框架底层使用Socket比较多

16、socket通讯的过程

- 基于TCP：服务器端先初始化socket，然后与端口号绑定，对端口进行监听，调用accept阻塞，等待客户端连接，这是如果有客户端初始化一个socket，然后连接服务器，建立连接。客户端发送数据请求，服务器端接收请求并处理请求，然后把回应数据发送给客户端，客户端读取诗句，最后关闭连接，一次交互结束，
- 基于UDP：UDP协议是用户数据报协议的简称，也用于网络数据的传输，虽然UDP协议是一种不太可靠的协议，但有时需要较快的接收数据并且可以忍受较小错误的情况下，UDP就会表现更大的优势，客户端只需要发送，服务端能不能接收，甭管。



HTTP

16、什么是HTTP协议？

- http协议是对客户端和服务端之间数据之间实现可靠性的传输文字，图片，音频，视频等超文本数据的规范，格式简称为超文本传输协议
- http属于应用层，及用户访问的第一层就是http

17、socket和http的区别

- socket连接就是所谓的长连接，理论上客户端和服务器端一旦建立连接，将不会主动断掉
- socket使用场景：网络游戏，银行持续交互，直播，在线视频
- http连接所谓的短连接，就是客户端向服务器端发送一次请求，服务器响应后连接就会断开等待下次连接
- http适应：公司OA服务，互联网服务，电商，办公，网站

18、什么是http的请求体？

- http请求体是我们请求数据时先发送给服务器的数据，毕竟我们向服务器拿数据，先表明自己要拿什么。

- http请求体由：请求行，请求头，请求数据组成；

- 注意get请求是没有请求体的。

  1、POST请求

![image-20210816231422817](C:\Users\CS_Chan\AppData\Roaming\Typora\typora-user-images\image-20210816231422817.png)

​	2、GET请求（无请求体）

![image-20210816231454621](C:\Users\CS_Chan\AppData\Roaming\Typora\typora-user-images\image-20210816231454621.png)

19、http的响应报文有哪些？

- http的响应式服务器返回给我们的数据，必须先有请求体再有响应报文
- 响应报文包含三部分，状态行，响应首部字段，响应内容实体实现。
- ![image-20210816231628916](C:\Users\CS_Chan\AppData\Roaming\Typora\typora-user-images\image-20210816231628916.png)

20、http和https的区别

- https就是http加上加密处理（SSL安全通信线路）+认证+完整性保护
- 区别：
  - http需要拿到ca证书，需要钱
  - 端口不一样，http80，https443
  - http超文本传输协议，信息是明文传输，https则具有安全性的ssl加密传输协议
  - http和https使用完全不同的连接方式（http连接简单，无状态；https有SSL+HTTP协议构成可进行加密传输，身份认证的网络协议，比http协议安全）

21、https工作原理

- 首先https请求服务端生成证书，客户端对证书的有效期，合法性，域名是否与请求的域名一致，证书的公钥（RSA加密）等进行校验
- 客户端如果通过后，根据证书的公钥的有效性，生成随机数，随机数使用公钥进行加密（RSA加密）
- 消息体产生的后，对它的摘要进行MD5（或者SHA1）加密，此时等到RSA签名
- 发送给服务端，此时服务端只有RSA私钥能解密
- 解密得到的随机数，在用AES加密，作为密钥，此时的密钥只有客户端和服务端知道。

22、一次完整的HTTP请求所经历的几个步骤

1. 建立TCP连接（三次握手）
2. web浏览器向web服务器发送请求行 get ****
3. web浏览器发送请求头：发送请求行之后要以头信息的形式向web服务器发送一些别的信息
4. web服务器应答。 **HTTP/1.1 200 OK** 应答的第一部分是协议的版本号和应答状态码
5. web服务器发送应答头
6. web服务器向浏览器发送数据**它就以Content-Type应答头信息所描述的格式发送用户所请求的实际数据**。
7. web服务器关闭TCP连接



23、HTTP状态码是怎么分类的，有哪些常见的状态码

| 类别  | 描述                                    |
| ----- | --------------------------------------- |
| 1xx： | 指示信息–表示请求已接收，正在处理       |
| 2xx： | 成功–表示请求已被成功接收、理解、接受   |
| 3xx： | 重定向–要完成请求必须进行更进一步的操作 |
| 4xx： | 客户端错误–请求有语法错误或请求无法实现 |
| 5xx： | 服务器端错误–服务器未能实现合法的请求   |

状态码	描述
200：	请求被正常处理
204：	请求被受理但没有资源可以返回
206：	客户端只是请求资源的一部分，服务器只对请求的部分资源执行GET方法，相应报文中通过Content-Range指定范围的资源。
301：	永久性重定向
302：	临时重定向
303：	与302状态码有相似功能，只是它希望客户端在请求一个URI的时候，能通过GET方法重定向到另一个URI上
304：	发送附带条件的请求时，条件不满足时返回，与重定向无关
307：	临时重定向，与302类似，只是强制要求使用POST方法
400：	请求报文语法有误，服务器无法识别
401：	请求需要认证
403：	请求的对应资源禁止被访问
404：	服务器无法找到对应资源
500：	服务器内部错误
503：	服务器正忙

24、http协议有哪些请求方式

请求方式	描述
GET：	用于请求访问已经被URI（统一资源标识符）识别的资源，可以通过URL传参给服务器
POST：	用于传输信息给服务器，主要功能与GET方法类似，但一般推荐使用POST方式。
PUT：	传输文件，报文主体中包含文件内容，保存到对应URI位置。
HEAD：	获得报文首部，与GET方法类似，只是不返回报文主体，一般用于验证URI是否有 效。
PATCH：	客户端向服务器传送的数据取代指定的文档的内容(部分取代)
TRACE：	回显客户端请求服务器的原始请求报文，用于"回环"诊断
DELETE：	删除文件，与PUT方法相反，删除对应URI位置的文件。
OPTIONS：	查询相应URI支持的HTTP方法。

25、GET与POST区别

- get重点在从服务器上获取资源，post重点在向服务器发送数据。
- get传输的数据量小，因为受url 长度限制，但效率较高。
  - post可以传输大量数据，所以上传文件只能用post方式。
- get不安全，因为get请求发送数据在url上，是可见的，可能会泄露私密信息如密码
  - post放在请求头部的，是安全的

26、http版本的对比

- http1.0版本特性
  - 早先1.0版本，是一种无状态，无连接的应用层协议
  - http1.0规定浏览器和服务器保持短暂的连接，浏览器的每次请求都需要与服务器建立一个TCP连接，服务器处理完成后立即断开TCP连接（无状态）；服务器不跟踪每个客户端也不记录过去的请求（无状态）
- http1.1版本特性
  - 默认持久连接节省通信量，只要客户端服务端任意一端没有明确提出断开TCP连接，就一直保持连接，可以发送多次HTTP请求
  - 管线化，客户端可以同时发出多个HTTP请求，而不是一个个等待响应
  - 断点续传原理
- http2.0版本特性
  - 二进制分帧（采用二进制格式的编码将其封装）
  - 首部压缩：设置了专门的首部压缩设计的HPACK算法
  - 流量控制：设置接收某个数据流的多少字节一些流量控制
  - 多路复用：可以在共享TCP链接的基础上同时发送请求和响应
  - 请求优先级：可以通过优化这些帧的交错和传输顺序进一步优化性能
  - 服务器推送：就是服务器可以对一个客户端请求发送多个响应，服务器向客户端推送资源无需客户端明确的请求。

27、什么是对称加密和非对称加密

- 对称加密是指：加密和解密使用同一个密钥的方式；这种方式存在的最大问题就是密钥发送问题，即如何安全的将密钥发送给对方
- 非对称加密：使用一对非对称密钥即 公钥和私钥，公钥可以随意发布，但私钥只有自己知道，发送密文的一方使用对方的公钥进行加密处理，对方接收到加密信息后，使用自己的私钥进行解密。由于非对称加密的方式不需要发送用来解密的私钥，所以可以保证安全性，但是和对称加密比起来，非常的满。

28、cookie和session 对于http有什么用？

- http协议无法判断用户身份，所以需要cookie或者session

- cookie：是由web服务器保存在用户浏览器的文件（键值对），可以包含用户相关的信息，客户端向服务器发起请求，就提取浏览器中的用户信息有由http发送给服务器

- session：是浏览器和服务器会话过程中服务器会分配的一块存储空间给session

- 服务器默认客户浏览器的cookie设置sessionid，这是sessionid就和cookie对应，在浏览器向服务器请求过程中传输的cookie包含sessionid，服务器根据传输的cookie的sessionid获取会话存储的信息，然后确认会话的身份信息

  

29、cookie和session区别？

- cookie数据存放在客户端上，安全性较差，session数据放在服务器上，安全性较高
- 单个cookie保存的数据不能超过4k，session无限制
- session一定时间内保存在服务器上，当访问增多，占用服务器性能，考虑服务器性能应当使用cookie
- 